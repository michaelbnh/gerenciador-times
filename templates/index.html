<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Gerenciamento de Times</title>

    <!-- üîë ESSENCIAL PARA RESPONSIVIDADE -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- CSS EXTERNO -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>

<div class="container">
    <div class="grid">

        <!-- COLUNA ESQUERDA -->
        <div class="card">
            <h2>Adicionar Jogadores</h2>

            <form method="POST">
                <input type="hidden" name="acao" value="adicionar">
                <input type="text" name="nome" placeholder="Nome do jogador" required>
                <button type="submit">Adicionar</button>
            </form>

            <h3>Jogadores adicionados</h3>

            <form method="POST">
                <input type="hidden" name="acao" value="criar">

                <div class="jogadores-grid">
                    {% for jogador in jogadores %}
                    <div class="jogador cor-{{ loop.index0 % 8 + 1 }}">
                        <strong>{{ loop.index }}¬∫ ‚Äì {{ jogador }}</strong>

                        <div style="margin-top:6px; font-size:12px;">
                            <label>
                                <input type="checkbox"
                                       name="time1"
                                       value="{{ jogador }}"
                                       class="time1"
                                       onchange="controlarSelecao(this)">
                                Time 1
                            </label>

                            <label style="margin-left:8px;">
                                <input type="checkbox"
                                       name="time2"
                                       value="{{ jogador }}"
                                       class="time2"
                                       onchange="controlarSelecao(this)">
                                Time 2
                            </label>
                        </div>
                    </div>
                    {% endfor %}
                </div>

                <button type="submit" style="margin-top:10px;">
                    Criar Times
                </button>
            </form>

            <a href="/resetar" class="danger">üîÑ Resetar tudo</a>
        </div>

        <!-- COLUNA DIREITA -->
        <div>

            <h2>üèüÔ∏è Times Ativos</h2>

            {% for time in times %}
            <div class="card time-ativo">
                <h3>Time {{ loop.index }}</h3>

                {% for jogador in time %}
                    <span class="jogador cor-{{ loop.index0 % 8 + 1 }}">
                        {{ jogador }}
                    </span>
                {% endfor %}

                <div style="margin-top:10px;">
                    ‚ùå <a href="/perdeu/{{ loop.index }}">Time {{ loop.index }} perdeu</a>
                </div>
            </div>
            {% endfor %}

            <h2>‚è≥ Times em Espera</h2>

            {% if fila %}
            <div class="card time-espera">
                {% for jogador in fila %}
                    <span class="jogador cor-{{ loop.index0 % 8 + 1 }}">
                        {{ jogador }}
                    </span>
                {% endfor %}
            </div>
            {% else %}
                <p>Nenhum time em espera.</p>
            {% endif %}

            <h2>üìú Hist√≥rico de Partidas</h2>

            {% if historico %}
                {% for h in historico %}
                <div class="card">
                    <strong>Partida {{ h.partida }}</strong><br><br>

                    üèÜ <strong>Vencedor:</strong><br>
                    {% for j in h.vencedor %}
                        <span class="jogador cor-{{ loop.index0 % 8 + 1 }}">{{ j }}</span>
                    {% endfor %}

                    <br><br>

                    ‚ùå <strong>Perdedor:</strong><br>
                    {% for j in h.perdedor %}
                        <span class="jogador cor-{{ loop.index0 % 8 + 1 }}">{{ j }}</span>
                    {% endfor %}

                    <br><br>

                    üîÑ <strong>Entrou:</strong><br>
                    {% if h.entrou %}
                        {% for j in h.entrou %}
                            <span class="jogador cor-{{ loop.index0 % 8 + 1 }}">{{ j }}</span>
                        {% endfor %}
                    {% else %}
                        <em>Ningu√©m</em>
                    {% endif %}
                </div>
                {% endfor %}
            {% else %}
                <p>Nenhuma partida registrada ainda.</p>
            {% endif %}

        </div>

    </div>
</div>

<!-- JAVASCRIPT -->
<script>
const LIMITE = 7;

function controlarSelecao(checkbox) {
    const card = checkbox.closest('.jogador');
    const time1 = card.querySelector('.time1');
    const time2 = card.querySelector('.time2');

    if (checkbox === time1 && time1.checked) {
        time2.checked = false;
        time2.disabled = true;
    } else if (checkbox === time2 && time2.checked) {
        time1.checked = false;
        time1.disabled = true;
    } else {
        time1.disabled = false;
        time2.disabled = false;
    }

    controlarLimite('time1');
    controlarLimite('time2');
}

function controlarLimite(classe) {
    const checkboxes = document.querySelectorAll(`.${classe}`);
    const selecionados = Array.from(checkboxes).filter(c => c.checked);

    checkboxes.forEach(c => {
        if (!c.checked) {
            const card = c.closest('.jogador');
            const outro = classe === 'time1'
                ? card.querySelector('.time2')
                : card.querySelector('.time1');

            c.disabled = selecionados.length >= LIMITE || outro.checked;
        }
    });
}
</script>

</body>
</html>
